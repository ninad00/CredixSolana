import{c as X,j as l,q as e,x as v,z as c,y as Y,D as ee,F as te,P as M,B as D,A as ae,S as se}from"./index-pi6Ztd27.js";import{c as ne,f as z}from"./fetchallaccounts-CgTnSnyo.js";import{d as ie,C as oe,a as re,c as le,g as ce}from"./source-Ck9LQvm6.js";import{T as de,f as me}from"./TokenIcon-UFryZpn9.js";import{I as he}from"./input-XN1kasC4.js";import{L as xe}from"./loader-circle-BiaaNxeP.js";import{C as ge}from"./circle-check-big-DtrSUpW8.js";import{u as ue}from"./useAnchorWallet-mr6MGh28.js";import{g as F,A as pe,T as fe}from"./mint--i00LiPk.js";/**
 * @license lucide-react v0.516.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 15 21.84",key:"14ibmq"}],["path",{d:"M21 5V8",key:"1marbg"}],["path",{d:"M21 12L18 17H22L19 22",key:"zafso"}],["path",{d:"M3 12A9 3 0 0 0 14.59 14.87",key:"1y4wr8"}]],ke=X("database-zap",ye),b=6,T=s=>{try{const n=typeof s=="string"?new c(s):s,m=new c(10).pow(new c(b)),h=n.div(m),x=n.mod(m);if(x.isZero())return h.toString();const f=x.toString().padStart(b,"0").replace(/0+$/,"");return`${h.toString()}.${f}`}catch{return"0"}},be=s=>{if(!s)return new c(0);try{const n=s.split("."),m=new c(n[0]||0);let h=new c(0);if(n[1]){const f=n[1].slice(0,b).padEnd(b,"0");h=new c(f)}const x=new c(10).pow(new c(b));return m.mul(x).add(h)}catch{return null}},je=()=>e.jsx("div",{className:"space-y-6",children:[...Array(2)].map((s,n)=>e.jsxs("div",{className:"bg-gray-900/50 border-gray-800 rounded-xl p-6 space-y-4 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-700 rounded w-1/2"}),e.jsx("div",{className:"h-20 bg-gray-700 rounded"}),e.jsx("div",{className:"h-12 bg-gray-700 rounded"})]},n))}),we=()=>e.jsxs("div",{className:"text-center py-24",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-900 border-2 border-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(ke,{className:"h-8 w-8 text-gray-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"No Configurations Found"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"The protocol configurations have not been set up yet."})]});function qe(){var L,B;const s=ue(),[n,m]=l.useState([]),[h,x]=l.useState(!0),[f,A]=l.useState({}),[S,O]=l.useState({}),[Ne,C]=l.useState(null),[d,V]=l.useState({}),[P,ve]=l.useState({}),j=l.useCallback((t,a)=>{O(o=>({...o,[t]:{...o[t],...a}}))},[]),H=l.useCallback(t=>S[t]||{isLoading:!1,txSig:null,error:null},[S]),R=async t=>{if(!(s!=null&&s.publicKey)||!s.signTransaction)return;const a=ce(s);if(!a)return;const o=f[t.tokenMint];if(!o||o.isZero()){j(t.tokenMint,{error:"Please enter a valid amount"});return}j(t.tokenMint,{isLoading:!0,error:null,txSig:null});const r=s.publicKey,i=new M(t.tokenMint),g=new M(t.publicKey);try{const y=await F(i,g,!0),k=await F(i,r),[Z]=M.findProgramAddressSync([D.from("liq_deposit"),r.toBuffer(),i.toBuffer()],a.programId),[G]=M.findProgramAddressSync([D.from("lp"),r.toBuffer(),i.toBuffer()],a.programId),u=a.provider.connection;if(!await u.getAccountInfo(k)){const p=ne(r,k,r,i),N=new ae().add(p),{blockhash:K,lastValidBlockHeight:_}=await u.getLatestBlockhash("finalized");N.recentBlockhash=K,N.lastValidBlockHeight=_,N.feePayer=s.publicKey;const J=await s.signTransaction(N),Q=await u.sendRawTransaction(J.serialize());await u.confirmTransaction({blockhash:K,lastValidBlockHeight:_,signature:Q})}const w=await a.methods.giveLiquidity(o).accountsStrict({user:s.publicKey,tokenMint:i,userTokenAccount:k,lpData:G,liqDeposit:Z,config:g,vault:y,tokenProgram:fe,systemProgram:se.programId,associatedTokenProgram:pe}).transaction(),{blockhash:I,lastValidBlockHeight:E}=await u.getLatestBlockhash("finalized");w.recentBlockhash=I,w.lastValidBlockHeight=E,w.feePayer=s.publicKey;const W=await s.signTransaction(w),q=await u.sendRawTransaction(W.serialize());await u.confirmTransaction({blockhash:I,lastValidBlockHeight:E,signature:q}),j(t.tokenMint,{isLoading:!1,txSig:q,error:null}),A(p=>({...p,[t.tokenMint]:new c(0)}));try{const p=await z(s);m(p)}catch(p){console.error("Failed to refresh configs:",p)}}catch{}},$=(t,a)=>{const o=be(a);o!==null&&A(r=>({...r,[t]:o})),j(t,{error:null})};if(l.useEffect(()=>{console.log("Configs changed, loading metadata for:",n.map(a=>{var o;return{mint:a.tokenMint,name:((o=d[a.tokenMint])==null?void 0:o.name)||"Not loaded"}}));const t=async()=>{const a={},o=n.filter(r=>!d[r.tokenMint]);console.log(`Fetching metadata for ${o.length} tokens:`,o.map(r=>r.tokenMint.slice(0,4)+"..."+r.tokenMint.slice(-4)));try{(await Promise.allSettled(o.map(i=>me(i.tokenMint).then(g=>({tokenMint:i.tokenMint,metadata:g}))))).forEach(i=>{i.status==="fulfilled"&&i.value.metadata?(console.log(`Fetched metadata for ${i.value.tokenMint}:`,i.value.metadata),a[i.value.tokenMint]=i.value.metadata):i.status==="rejected"&&console.error("Error fetching token metadata:",i.reason)}),Object.keys(a).length>0?(console.log("Updating token metadata map with new entries"),V(i=>({...i,...a}))):console.log("No new token metadata to update")}catch(r){console.error("Error in token metadata loading batch:",r)}};n.length>0&&t()},[n,d]),l.useEffect(()=>{if(!s)return;(async()=>{x(!0),C(null);try{const a=await z(s);m(a)}catch{C("Failed to load token configurations. Please try again.")}finally{x(!1)}})()},[s]),!s)return e.jsx("div",{className:"w-full bg-gray-950 text-white min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Connect Wallet"}),e.jsx("p",{className:"text-gray-400",children:"Please connect your wallet to view available liquidity pools."})]})});const U={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}};return e.jsxs("div",{className:"w-full bg-gray-950 text-white min-h-screen",children:[e.jsx("div",{className:"fixed bottom-4 right-4 bg-black/80 p-3 rounded-lg text-xs z-50 max-w-xs",children:e.jsxs("div",{className:"font-mono",children:[e.jsxs("div",{children:["Tokens: ",n.length]}),e.jsxs("div",{children:["Metadata: ",Object.keys(d).length]}),n.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{children:["First token: ",n[0].tokenMint.slice(0,6),"...",n[0].tokenMint.slice(-4)]}),e.jsxs("div",{children:["Name: ",((L=d[n[0].tokenMint])==null?void 0:L.name)||"Loading..."]}),e.jsxs("div",{children:["Has logo: ",(B=d[n[0].tokenMint])!=null&&B.logoURI?"✅":"❌"]})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 py-12",children:[e.jsxs(v.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-12",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white",children:"Liquidity Pools"}),e.jsx("p",{className:"text-lg text-gray-400 mt-2",children:"Provide liquidity to earn yield from protocol fees."})]}),h?e.jsx(je,{}):n.length===0?e.jsx(we,{}):e.jsx(v.div,{className:"space-y-6",variants:U,initial:"hidden",animate:"visible",children:n.map(t=>{var i,g,y;const a=H(t.tokenMint),o=f[t.tokenMint]||new c(0),r=T(o);return e.jsxs(ie,{className:"bg-gray-900/50 border-gray-800 overflow-hidden",children:[e.jsx(oe,{children:e.jsxs(re,{className:"text-xl text-white flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(de,{mintAddress:t.tokenMint,size:24}),!((i=d[t.tokenMint])!=null&&i.logoURI)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-xs font-bold text-white",children:t.tokenMint.slice(0,2).toUpperCase()})]}),e.jsxs("span",{className:"break-all ml-3",children:[((g=d[t.tokenMint])==null?void 0:g.name)||"Token",e.jsxs("span",{className:"text-sm text-gray-400 block mt-1",children:[((y=d[t.tokenMint])==null?void 0:y.symbol)||"TOKEN",P[t.tokenMint]>0&&e.jsxs("span",{className:"ml-2 text-green-400",children:["($",(P[t.tokenMint]/1e4).toFixed(4),")"]})]})]})]})}),e.jsxs(le,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-900 border border-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Total Liquidity"}),e.jsx("span",{className:"font-mono text-lg text-white",children:T(t.totalLiq)})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Fees Collected"}),e.jsx("span",{className:"font-mono text-lg text-green-400",children:T(t.totalCollected)})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{type:"number",step:"any",min:"0",value:r==="0"?"":r,placeholder:"0.00",onChange:k=>$(t.tokenMint,k.target.value),disabled:a.isLoading,className:"bg-gray-800 border-gray-700 h-12 text-lg pr-40"}),e.jsx(Y,{className:"absolute top-1.5 right-1.5 h-9 bg-purple-600 hover:bg-purple-700 text-white",onClick:()=>R(t),disabled:a.isLoading||o.isZero(),children:a.isLoading?e.jsx(xe,{className:"h-4 w-4 animate-spin"}):"Provide Liquidity"})]}),e.jsxs(ee,{children:[a.error&&e.jsxs(v.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-red-900/30 text-red-400 text-sm p-3 border border-red-800 rounded-md flex items-start gap-2",children:[e.jsx(te,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Error:"})," ",a.error.Logs[0]]})]}),a.txSig&&e.jsxs(v.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-green-900/30 text-green-400 text-sm p-3 border border-green-800 rounded-md flex items-start gap-2",children:[e.jsx(ge,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("strong",{children:"Success:"}),e.jsx("a",{href:`https://explorer.solana.com/tx/${a.txSig}?cluster=devnet`,target:"_blank",rel:"noreferrer",className:"ml-2 text-purple-400 hover:text-purple-300 underline break-all",children:"View Transaction"})]})]})]})]})]},t.publicKey)})})]})]})}export{qe as default};
