import{c as X,j as c,q as e,x as T,z as d,y as Y,D as ee,F as te,P as A,B as F,A as ae,S as se}from"./index-B7vkYCve.js";import{C as ne,g as O,c as ie,A as oe,T as re,f as V}from"./fetchallaccounts-CPPSWCQ-.js";import{d as le,C as ce,c as de,b as me,g as he}from"./source-B7nfvOd2.js";import{T as ge,f as xe}from"./TokenIcon-LF4L0gzO.js";import{I as ue}from"./input-BzVyemLo.js";import{L as pe}from"./loader-circle-C00ltvLf.js";import{u as fe}from"./useAnchorWallet-BHa7C_ie.js";/**
 * @license lucide-react v0.516.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 15 21.84",key:"14ibmq"}],["path",{d:"M21 5V8",key:"1marbg"}],["path",{d:"M21 12L18 17H22L19 22",key:"zafso"}],["path",{d:"M3 12A9 3 0 0 0 14.59 14.87",key:"1y4wr8"}]],ke=X("database-zap",ye),w=6,S=s=>{try{const n=typeof s=="string"?new d(s):s,g=new d(10).pow(new d(w)),x=n.div(g),u=n.mod(g);if(u.isZero())return x.toString();const k=u.toString().padStart(w,"0").replace(/0+$/,"");return`${x.toString()}.${k}`}catch{return"0"}},be=s=>{if(!s)return new d(0);try{const n=s.split("."),g=new d(n[0]||0);let x=new d(0);if(n[1]){const k=n[1].slice(0,w).padEnd(w,"0");x=new d(k)}const u=new d(10).pow(new d(w));return g.mul(u).add(x)}catch{return null}},je=()=>e.jsx("div",{className:"space-y-6",children:[...Array(2)].map((s,n)=>e.jsxs("div",{className:"bg-gray-900/50 border-gray-800 rounded-xl p-6 space-y-4 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-700 rounded w-1/2"}),e.jsx("div",{className:"h-20 bg-gray-700 rounded"}),e.jsx("div",{className:"h-12 bg-gray-700 rounded"})]},n))}),we=()=>e.jsxs("div",{className:"text-center py-24",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-900 border-2 border-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(ke,{className:"h-8 w-8 text-gray-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"No Configurations Found"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"The protocol configurations have not been set up yet."})]});function Be(){var B,E;const s=fe(),[n,g]=c.useState([]),[x,u]=c.useState(!0),[k,C]=c.useState({}),[P,H]=c.useState({}),[Ne,L]=c.useState(null),[h,R]=c.useState({}),[I,ve]=c.useState({}),b=c.useCallback((t,a)=>{H(o=>({...o,[t]:{...o[t],...a}}))},[]),$=c.useCallback(t=>P[t]||{isLoading:!1,txSig:null,error:null},[P]),U=async t=>{if(!(s!=null&&s.publicKey)||!s.signTransaction)return;const a=he(s);if(!a)return;const o=k[t.tokenMint];if(!o||o.isZero()){b(t.tokenMint,{error:"Please enter a valid amount"});return}b(t.tokenMint,{isLoading:!0,error:null,txSig:null});const r=s.publicKey,i=new A(t.tokenMint),p=new A(t.publicKey);try{const l=await O(i,p,!0),m=await O(i,r),[N]=A.findProgramAddressSync([F.from("liq_deposit"),r.toBuffer(),i.toBuffer()],a.programId),[j]=A.findProgramAddressSync([F.from("lp"),r.toBuffer(),i.toBuffer()],a.programId),f=a.provider.connection;if(!await f.getAccountInfo(m)){const y=ie(r,m,r,i),M=new ae().add(y),{blockhash:D,lastValidBlockHeight:z}=await f.getLatestBlockhash("finalized");M.recentBlockhash=D,M.lastValidBlockHeight=z,M.feePayer=s.publicKey;const J=await s.signTransaction(M),Q=await f.sendRawTransaction(J.serialize());await f.confirmTransaction({blockhash:D,lastValidBlockHeight:z,signature:Q})}const v=await a.methods.giveLiquidity(o).accountsStrict({user:s.publicKey,tokenMint:i,userTokenAccount:m,lpData:j,liqDeposit:N,config:p,vault:l,tokenProgram:re,systemProgram:se.programId,associatedTokenProgram:oe}).transaction(),{blockhash:q,lastValidBlockHeight:K}=await f.getLatestBlockhash("finalized");v.recentBlockhash=q,v.lastValidBlockHeight=K,v.feePayer=s.publicKey;const W=await s.signTransaction(v),_=await f.sendRawTransaction(W.serialize());await f.confirmTransaction({blockhash:q,lastValidBlockHeight:K,signature:_}),b(t.tokenMint,{isLoading:!1,txSig:_,error:null}),C(y=>({...y,[t.tokenMint]:new d(0)}));try{const y=await V(s);g(y)}catch(y){console.error("Failed to refresh configs:",y)}}catch(l){console.error("Transaction failed:",l);let m="Transaction failed";if(l&&typeof l=="object"&&"logs"in l&&Array.isArray(l.logs)){const N=l.logs;N.some(j=>j.includes("insufficient funds"))?m="Insufficient token balance. Please check your wallet balance.":N.some(j=>j.includes("custom program error"))&&(m="Transaction failed. Please try again or check your inputs.")}else l instanceof Error&&(m=l.message);b(t.tokenMint,{isLoading:!1,error:{Logs:[m]}})}},Z=(t,a)=>{const o=be(a);o!==null&&C(r=>({...r,[t]:o})),b(t,{error:null})};if(c.useEffect(()=>{console.log("Configs changed, loading metadata for:",n.map(a=>{var o;return{mint:a.tokenMint,name:((o=h[a.tokenMint])==null?void 0:o.name)||"Not loaded"}}));const t=async()=>{const a={},o=n.filter(r=>!h[r.tokenMint]);console.log(`Fetching metadata for ${o.length} tokens:`,o.map(r=>r.tokenMint.slice(0,4)+"..."+r.tokenMint.slice(-4)));try{(await Promise.allSettled(o.map(i=>xe(i.tokenMint).then(p=>({tokenMint:i.tokenMint,metadata:p}))))).forEach(i=>{i.status==="fulfilled"&&i.value.metadata?(console.log(`Fetched metadata for ${i.value.tokenMint}:`,i.value.metadata),a[i.value.tokenMint]=i.value.metadata):i.status==="rejected"&&console.error("Error fetching token metadata:",i.reason)}),Object.keys(a).length>0?(console.log("Updating token metadata map with new entries"),R(i=>({...i,...a}))):console.log("No new token metadata to update")}catch(r){console.error("Error in token metadata loading batch:",r)}};n.length>0&&t()},[n,h]),c.useEffect(()=>{if(!s)return;(async()=>{u(!0),L(null);try{const a=await V(s);g(a)}catch{L("Failed to load token configurations. Please try again.")}finally{u(!1)}})()},[s]),!s)return e.jsx("div",{className:"w-full bg-gray-950 text-white min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Connect Wallet"}),e.jsx("p",{className:"text-gray-400",children:"Please connect your wallet to view available liquidity pools."})]})});const G={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}};return e.jsxs("div",{className:"w-full bg-gray-950 text-white min-h-screen",children:[e.jsx("div",{className:"fixed bottom-4 right-4 bg-black/80 p-3 rounded-lg text-xs z-50 max-w-xs",children:e.jsxs("div",{className:"font-mono",children:[e.jsxs("div",{children:["Tokens: ",n.length]}),e.jsxs("div",{children:["Metadata: ",Object.keys(h).length]}),n.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{children:["First token: ",n[0].tokenMint.slice(0,6),"...",n[0].tokenMint.slice(-4)]}),e.jsxs("div",{children:["Name: ",((B=h[n[0].tokenMint])==null?void 0:B.name)||"Loading..."]}),e.jsxs("div",{children:["Has logo: ",(E=h[n[0].tokenMint])!=null&&E.logoURI?"✅":"❌"]})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 py-12",children:[e.jsxs(T.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-12",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white",children:"Liquidity Pools"}),e.jsx("p",{className:"text-lg text-gray-400 mt-2",children:"Provide liquidity to earn yield from protocol fees."})]}),x?e.jsx(je,{}):n.length===0?e.jsx(we,{}):e.jsx(T.div,{className:"space-y-6",variants:G,initial:"hidden",animate:"visible",children:n.map(t=>{var i,p,l;const a=$(t.tokenMint),o=k[t.tokenMint]||new d(0),r=S(o);return e.jsxs(le,{className:"bg-gray-900/50 border-gray-800 overflow-hidden",children:[e.jsx(ce,{children:e.jsxs(de,{className:"text-xl text-white flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ge,{mintAddress:t.tokenMint,size:24}),!((i=h[t.tokenMint])!=null&&i.logoURI)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-xs font-bold text-white",children:t.tokenMint.slice(0,2).toUpperCase()})]}),e.jsxs("span",{className:"break-all ml-3",children:[((p=h[t.tokenMint])==null?void 0:p.name)||"Token",e.jsxs("span",{className:"text-sm text-gray-400 block mt-1",children:[((l=h[t.tokenMint])==null?void 0:l.symbol)||"TOKEN",I[t.tokenMint]>0&&e.jsxs("span",{className:"ml-2 text-green-400",children:["($",(I[t.tokenMint]/1e4).toFixed(4),")"]})]})]})]})}),e.jsxs(me,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-900 border border-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Total Liquidity"}),e.jsx("span",{className:"font-mono text-lg text-white",children:S(t.totalLiq)})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Fees Collected"}),e.jsx("span",{className:"font-mono text-lg text-green-400",children:S(t.totalCollected)})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{type:"number",step:"any",min:"0",value:r==="0"?"":r,placeholder:"0.00",onChange:m=>Z(t.tokenMint,m.target.value),disabled:a.isLoading,className:"bg-gray-800 border-gray-700 h-12 text-lg pr-40"}),e.jsx(Y,{className:"absolute top-1.5 right-1.5 h-9 bg-purple-600 hover:bg-purple-700 text-white",onClick:()=>U(t),disabled:a.isLoading||o.isZero(),children:a.isLoading?e.jsx(pe,{className:"h-4 w-4 animate-spin"}):"Provide Liquidity"})]}),e.jsxs(ee,{children:[a.error&&e.jsxs(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-red-900/30 text-red-400 text-sm p-3 border border-red-800 rounded-md flex items-start gap-2",children:[e.jsx(te,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Error:"})," ",a.error.Logs[0]]})]}),a.txSig&&e.jsxs(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-green-900/30 text-green-400 text-sm p-3 border border-green-800 rounded-md flex items-start gap-2",children:[e.jsx(ne,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("strong",{children:"Success:"}),e.jsx("a",{href:`https://explorer.solana.com/tx/${a.txSig}?cluster=devnet`,target:"_blank",rel:"noreferrer",className:"ml-2 text-purple-400 hover:text-purple-300 underline break-all",children:"View Transaction"})]})]})]})]})]},t.publicKey)})})]})]})}export{Be as default};
