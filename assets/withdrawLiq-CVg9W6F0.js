import{c as z,j as u,q as e,x as M,y as F,D as U,P as y,B as v,A as H,S as G,z as A}from"./index-RXDHe7VM.js";import{C as W,g as D,c as Y,T as Z,A as J,d as Q,e as X}from"./fetchallaccounts-C5SN_Gl4.js";import{g as B,d as ee,C as te,c as se,b as ae}from"./source-CRDwdvvb.js";import{C as re}from"./coins-Ch1t3hWF.js";import{P as q}from"./piggy-bank-BqcahMai.js";import{T as oe}from"./trending-up-D-gcvynF.js";import{L as ne}from"./loader-circle-Zlbc5mF9.js";import{u as ie}from"./useAnchorWallet-CaNXz_7g.js";/**
 * @license lucide-react v0.516.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],le=z("chart-pie",ce),I=6,E=t=>{try{const g=typeof t=="number"?new A(t):typeof t=="string"?new A(t):t,j=new A(10).pow(new A(I)),w=g.div(j),f=g.mod(j);if(f.isZero())return w.toString();const N=f.toString().padStart(I,"0").replace(/0+$/,"");return`${w.toString()}.${N||"0"}`}catch{return"0.00"}},de=t=>`${t.slice(0,4)}...${t.slice(-4)}`,me=()=>e.jsx("div",{className:"space-y-6",children:[...Array(2)].map((t,g)=>e.jsxs("div",{className:"bg-gray-900/50 border-gray-800 rounded-xl p-6 space-y-4 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-700 rounded w-1/3"}),e.jsx("div",{className:"h-24 bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 bg-gray-700 rounded w-full"})]},g))}),ge=()=>e.jsxs("div",{className:"text-center py-24",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-900 border-2 border-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(q,{className:"h-8 w-8 text-gray-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"No Liquidity Positions Found"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"You have not provided liquidity to any pools yet."})]});function we(){const t=ie(),[g,j]=u.useState([]),[w,f]=u.useState(!0),[N,T]=u.useState({}),[_,R]=u.useState({}),k=u.useCallback((n,i)=>{T(r=>({...r,[n]:{...r[n],...i}}))},[]),$=async(n,i)=>{if(!(t!=null&&t.publicKey)||!t.signTransaction)return;const r=N[i];if(!r||r.isProcessing)return;k(i,{isProcessing:!0,error:null,txSig:null});const c=B(t);if(!c){k(i,{isProcessing:!1,error:"Program not available"});return}const l=c.provider.connection;try{const a=t.publicKey,d=new y(n.tokenMint),[h]=y.findProgramAddressSync([v.from("lp"),a.toBuffer(),d.toBuffer()],c.programId),[p]=y.findProgramAddressSync([v.from("config"),d.toBuffer()],c.programId),[P]=y.findProgramAddressSync([v.from("liq_deposit"),a.toBuffer(),d.toBuffer()],c.programId),C=await D(d,p,!0),b=await D(d,a);if(!await l.getAccountInfo(b)){const s=Y(a,b,a,d),o=new H().add(s),{blockhash:x,lastValidBlockHeight:m}=await l.getLatestBlockhash("finalized");o.recentBlockhash=x,o.lastValidBlockHeight=m,o.feePayer=a;const O=await t.signTransaction(o),V=await l.sendRawTransaction(O.serialize());await l.confirmTransaction({blockhash:x,lastValidBlockHeight:m,signature:V})}const S=await c.methods.redeemLiquidity().accountsStrict({user:a,lpData:h,tokenMint:d,liqDeposit:P,config:p,vault:C,userTokenAccount:b,systemProgram:G.programId,associatedTokenProgram:J,tokenProgram:Z}).rpc();k(i,{isProcessing:!1,txSig:S})}catch(a){console.error("Withdraw error:",a),k(i,{isProcessing:!1,error:a instanceof Error?a.message:"Unknown error occurred"})}};u.useEffect(()=>{if(!t)return;const n=B(t);if(!n){console.error("Program not available"),f(!1);return}(async()=>{f(!0);try{const[r,c]=await Promise.all([Q(t),X(t)]),l=r.filter(s=>s.user===t.publicKey.toBase58()),a=c.filter(s=>s.user===t.publicKey.toBase58()),d=l.filter((s,o,x)=>o===x.findIndex(m=>m.publicKey===s.publicKey)),h=a.filter((s,o,x)=>o===x.findIndex(m=>m.publicKey===s.publicKey)),p=new Map;h.forEach(s=>p.set(s.token,s));const P=d.map((s,o)=>({deposit:s,userData:p.get(s.tokenMint)||null,uniqueKey:`${s.publicKey}_${o}`})),C=d.map(async s=>{try{const o=new y(s.tokenMint),[x]=y.findProgramAddressSync([v.from("config"),o.toBuffer()],n.programId),m=await n.account.config.fetch(x);return{tokenMint:s.tokenMint,totalLiq:m.totalLiq.toString(),totalCollected:m.totalCollected.toString()}}catch{return{tokenMint:s.tokenMint,totalLiq:"0",totalCollected:"0"}}}),b=await Promise.all(C),L={};b.forEach(s=>{L[s.tokenMint]={totalLiq:s.totalLiq,totalCollected:s.totalCollected}}),R(L),j(P);const S={};P.forEach(({uniqueKey:s})=>{S[s]={isProcessing:!1,txSig:null,error:null}}),T(S)}catch(r){console.error("Error loading data:",r)}finally{f(!1)}})()},[t]);const K={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}};return e.jsx("div",{className:"w-full bg-gray-950 text-white min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 py-12",children:[e.jsxs(M.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-12",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white",children:"My Liquidity Positions"}),e.jsx("p",{className:"text-lg text-gray-400 mt-2",children:"View and redeem your provided liquidity and earnings."})]}),w?e.jsx(me,{}):g.length===0?e.jsx(ge,{}):e.jsx(M.div,{className:"space-y-6",variants:K,initial:"hidden",animate:"visible",children:g.map(({deposit:n,userData:i,uniqueKey:r})=>{const c=_[n.tokenMint],l=N[r];if(!l||!c||!i)return null;const a=parseFloat(c.totalLiq),d=parseFloat(i.tokenAmt),h=a>0?d/a:0,p=h*parseFloat(c.totalCollected);return e.jsxs(ee,{className:"bg-gray-900/50 border-gray-800 overflow-hidden",children:[e.jsx(te,{children:e.jsxs(se,{className:"text-xl text-white flex items-center gap-3",children:[e.jsx("span",{className:"p-2 bg-purple-600/20 border border-purple-500/30 rounded-md",children:e.jsx(re,{className:"h-5 w-5 text-purple-400"})}),`Position: ${de(n.tokenMint)}`]})}),e.jsxs(ae,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-900 border border-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"text-sm text-gray-400 flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"My Deposit"]}),e.jsx("span",{className:"font-mono text-lg text-white",children:E(i.tokenAmt)})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"text-sm text-gray-400 flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Pool Share"]}),e.jsxs("span",{className:"font-mono text-lg text-white",children:[(h*100).toFixed(4),"%"]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"text-sm text-gray-400 flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"My Earnings"]}),e.jsx("span",{className:"font-mono text-lg text-green-400",children:E(p)})]})]}),e.jsx(F,{className:"w-full h-11 text-base bg-purple-600 hover:bg-purple-700 text-white",onClick:()=>$(n,r),disabled:!(t!=null&&t.publicKey)||l.isProcessing,children:l.isProcessing?e.jsx(ne,{className:"h-5 w-5 animate-spin"}):"Redeem All Liquidity"}),e.jsx(U,{children:l.txSig&&e.jsxs(M.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-green-900/30 text-green-400 text-sm p-3 border border-green-800 rounded-md flex items-start gap-2",children:[e.jsx(W,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("strong",{children:"Success:"}),e.jsx("a",{href:`https://explorer.solana.com/tx/${l.txSig}?cluster=devnet`,target:"_blank",rel:"noreferrer",className:"ml-2 text-purple-400 hover:text-purple-300 underline break-all",children:"View Transaction"})]})]})})]})]},r)})})]})})}export{we as default};
