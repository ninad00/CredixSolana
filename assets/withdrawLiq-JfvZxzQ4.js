import{c as F,j as u,q as e,x as S,y as z,D as U,F as H,P as y,B as A,A as G,S as W,z as C}from"./index-nTJrk6Cr.js";import{C as Y,g as D,c as Z,T as J,A as Q,d as X,e as ee}from"./fetchallaccounts-B1Uk_Fj6.js";import{g as B,d as te,C as se,c as ae,b as re}from"./source-RH5lTv4m.js";import{C as oe}from"./coins-BO9fXETD.js";import{P as q}from"./piggy-bank-hGKB8Bas.js";import{T as ne}from"./trending-up-BLoeT-3U.js";import{L as ie}from"./loader-circle-DcjAOCym.js";import{u as ce}from"./useAnchorWallet-C1uQcfNX.js";/**
 * @license lucide-react v0.516.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],de=F("chart-pie",le),E=6,I=t=>{try{const g=typeof t=="number"?new C(t):typeof t=="string"?new C(t):t,j=new C(10).pow(new C(E)),N=g.div(j),f=g.mod(j);if(f.isZero())return N.toString();const w=f.toString().padStart(E,"0").replace(/0+$/,"");return`${N.toString()}.${w||"0"}`}catch{return"0.00"}},me=t=>`${t.slice(0,4)}...${t.slice(-4)}`,ge=()=>e.jsx("div",{className:"space-y-6",children:[...Array(2)].map((t,g)=>e.jsxs("div",{className:"bg-gray-900/50 border-gray-800 rounded-xl p-6 space-y-4 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-700 rounded w-1/3"}),e.jsx("div",{className:"h-24 bg-gray-700 rounded"}),e.jsx("div",{className:"h-10 bg-gray-700 rounded w-full"})]},g))}),xe=()=>e.jsxs("div",{className:"text-center py-24",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-900 border-2 border-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(q,{className:"h-8 w-8 text-gray-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"No Liquidity Positions Found"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"You have not provided liquidity to any pools yet."})]});function we(){const t=ce(),[g,j]=u.useState([]),[N,f]=u.useState(!0),[w,T]=u.useState({}),[_,R]=u.useState({}),k=u.useCallback((i,c)=>{T(o=>({...o,[i]:{...o[i],...c}}))},[]),$=async(i,c)=>{if(!(t!=null&&t.publicKey)||!t.signTransaction)return;const o=w[c];if(!o||o.isProcessing)return;k(c,{isProcessing:!0,error:null,txSig:null});const l=B(t);if(!l){k(c,{isProcessing:!1,error:"Program not available"});return}const r=l.provider.connection;try{const a=t.publicKey,d=new y(i.tokenMint),[h]=y.findProgramAddressSync([A.from("lp"),a.toBuffer(),d.toBuffer()],l.programId),[p]=y.findProgramAddressSync([A.from("config"),d.toBuffer()],l.programId),[P]=y.findProgramAddressSync([A.from("liq_deposit"),a.toBuffer(),d.toBuffer()],l.programId),L=await D(d,p,!0),b=await D(d,a);if(!await r.getAccountInfo(b)){const s=Z(a,b,a,d),n=new G().add(s),{blockhash:x,lastValidBlockHeight:m}=await r.getLatestBlockhash("finalized");n.recentBlockhash=x,n.lastValidBlockHeight=m,n.feePayer=a;const O=await t.signTransaction(n),V=await r.sendRawTransaction(O.serialize());await r.confirmTransaction({blockhash:x,lastValidBlockHeight:m,signature:V})}const v=await l.methods.redeemLiquidity().accountsStrict({user:a,lpData:h,tokenMint:d,liqDeposit:P,config:p,vault:L,userTokenAccount:b,systemProgram:W.programId,associatedTokenProgram:Q,tokenProgram:J}).rpc();k(c,{isProcessing:!1,txSig:v})}catch(a){console.error("Withdraw error:",a),k(c,{isProcessing:!1,error:a instanceof Error?a.message:"Unknown error occurred"})}};u.useEffect(()=>{if(!t)return;const i=B(t);if(!i){console.error("Program not available"),f(!1);return}(async()=>{f(!0);try{const[o,l]=await Promise.all([X(t),ee(t)]),r=o.filter(s=>s.user===t.publicKey.toBase58()),a=l.filter(s=>s.user===t.publicKey.toBase58()),d=r.filter((s,n,x)=>n===x.findIndex(m=>m.publicKey===s.publicKey)),h=a.filter((s,n,x)=>n===x.findIndex(m=>m.publicKey===s.publicKey)),p=new Map;h.forEach(s=>p.set(s.token,s));const P=d.map((s,n)=>({deposit:s,userData:p.get(s.tokenMint)||null,uniqueKey:`${s.publicKey}_${n}`})),L=d.map(async s=>{try{const n=new y(s.tokenMint),[x]=y.findProgramAddressSync([A.from("config"),n.toBuffer()],i.programId),m=await i.account.config.fetch(x);return{tokenMint:s.tokenMint,totalLiq:m.totalLiq.toString(),totalCollected:m.totalCollected.toString()}}catch{return{tokenMint:s.tokenMint,totalLiq:"0",totalCollected:"0"}}}),b=await Promise.all(L),M={};b.forEach(s=>{M[s.tokenMint]={totalLiq:s.totalLiq,totalCollected:s.totalCollected}}),R(M),j(P);const v={};P.forEach(({uniqueKey:s})=>{v[s]={isProcessing:!1,txSig:null,error:null}}),T(v)}catch(o){console.error("Error loading data:",o)}finally{f(!1)}})()},[t]);const K={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}};return e.jsx("div",{className:"w-full bg-gray-950 text-white min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 py-12",children:[e.jsxs(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-12",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white",children:"My Liquidity Positions"}),e.jsx("p",{className:"text-lg text-gray-400 mt-2",children:"View and redeem your provided liquidity and earnings."})]}),N?e.jsx(ge,{}):g.length===0?e.jsx(xe,{}):e.jsx(S.div,{className:"space-y-6",variants:K,initial:"hidden",animate:"visible",children:g.map(({deposit:i,userData:c,uniqueKey:o})=>{const l=_[i.tokenMint],r=w[o];if(!r||!l||!c)return null;const a=parseFloat(l.totalLiq),d=parseFloat(c.tokenAmt),h=a>0?d/a:0,p=h*parseFloat(l.totalCollected);return e.jsxs(te,{className:"bg-gray-900/50 border-gray-800 overflow-hidden",children:[e.jsx(se,{children:e.jsxs(ae,{className:"text-xl text-white flex items-center gap-3",children:[e.jsx("span",{className:"p-2 bg-purple-600/20 border border-purple-500/30 rounded-md",children:e.jsx(oe,{className:"h-5 w-5 text-purple-400"})}),`Position: ${me(i.tokenMint)}`]})}),e.jsxs(re,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-900 border border-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"text-sm text-gray-400 flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"My Deposit"]}),e.jsx("span",{className:"font-mono text-lg text-white",children:I(c.tokenAmt)})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"text-sm text-gray-400 flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Pool Share"]}),e.jsxs("span",{className:"font-mono text-lg text-white",children:[(h*100).toFixed(4),"%"]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"text-sm text-gray-400 flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"My Earnings"]}),e.jsx("span",{className:"font-mono text-lg text-green-400",children:I(p)})]})]}),e.jsx(z,{className:"w-full h-11 text-base bg-purple-600 hover:bg-purple-700 text-white",onClick:()=>$(i,o),disabled:!(t!=null&&t.publicKey)||r.isProcessing,children:r.isProcessing?e.jsx(ie,{className:"h-5 w-5 animate-spin"}):"Redeem All Liquidity"}),e.jsxs(U,{children:[r.error&&e.jsxs(S.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-red-900/30 text-red-400 text-sm p-3 border border-red-800 rounded-md flex items-start gap-2",children:[e.jsx(H,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Error:"})," ",r.error]})]}),r.txSig&&e.jsxs(S.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-green-900/30 text-green-400 text-sm p-3 border border-green-800 rounded-md flex items-start gap-2",children:[e.jsx(Y,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("strong",{children:"Success:"}),e.jsx("a",{href:`https://explorer.solana.com/tx/${r.txSig}?cluster=devnet`,target:"_blank",rel:"noreferrer",className:"ml-2 text-purple-400 hover:text-purple-300 underline break-all",children:"View Transaction"})]})]})]})]})]},o)})})]})})}export{we as default};
