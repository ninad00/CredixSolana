import{c as L,o as R,j as u,z as d,q as e,P as m,B as T,S as K,x as W,E as q}from"./index-CjnjuBa7.js";import{g as B,D as O,I as J,d as D,C as F,a as _,b as H,c as V}from"./source-D5IHAeb_.js";import{g as Q}from"./tp-CZobGuSk.js";import{u as $}from"./useAnchorWallet-BEAn8DEn.js";import{g as U,T as M,A as z}from"./mint-D2J8TJV_.js";/**
 * @license lucide-react v0.516.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],Y=L("power",X);/**
 * @license lucide-react v0.516.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ee=L("settings",Z);function te(){const o=$(),{connection:a}=R(),[h,N]=u.useState(""),[E,j]=u.useState(new d(0)),[v,x]=u.useState(!1),[p,b]=u.useState(null),I=i=>{N(i.target.value)},C=async()=>{if(!(!o||!a))try{const i=B(o);if(!i)throw new Error("Failed to load program.");const l=new m(h);if(!m.isOnCurve(l))throw new Error("Invalid mint address.");const[f]=m.findProgramAddressSync([T.from("config"),l.toBuffer()],i.programId),[P]=m.findProgramAddressSync([T.from("price"),l.toBuffer()],i.programId);if(await a.getAccountInfo(f)!==null)throw new Error("Config account already initialized for this token mint.");const n=await U(l,f,!0,M,z);x(!0),b(null);const t=await Q(h);console.log("Fetched price:",t.toString());const c=d.isBN(t)?t:new d(t);j(c);const s=await i.methods.startToken(c).accountsStrict({config:f,price:P,tokenMint:l,vault:n,admin:o.publicKey,systemProgram:K.programId,tokenProgram:M,associatedTokenProgram:z}).transaction(),{blockhash:w,lastValidBlockHeight:y}=await a.getLatestBlockhash("finalized");s.recentBlockhash=w,s.lastValidBlockHeight=y,s.feePayer=o.publicKey;const A=await o.signTransaction(s),k=await a.sendRawTransaction(A.serialize());await a.confirmTransaction({blockhash:w,lastValidBlockHeight:y,signature:k});const g=await i.account.config.fetch(f),G=await i.account.price.fetch(P);console.log("Config account created:",g),console.log("Price account created:",G),b(k)}catch(i){console.error("Transaction failed:",i)}finally{x(!1)}};return e.jsxs("div",{className:"Create card p-4 max-w-md mx-auto",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Create Config"}),e.jsx("input",{type:"text",value:h,placeholder:"Token Mint Address",onChange:I,className:"mb-2 p-2 border w-full rounded"}),e.jsx("button",{onClick:C,disabled:!(o!=null&&o.publicKey)||v,className:"bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 disabled:opacity-50 w-full",children:v?"Creating...":"Create Config Account"}),p&&e.jsxs("p",{className:"mt-4 text-sm",children:["View on Explorer:"," ",e.jsx("a",{href:`https://explorer.solana.com/tx/${p}?cluster=devnet`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:p})]})]})}const S=(o,a)=>(o.toNumber()/a).toFixed(4);function ae(){const o=O,a=$(),{connection:h}=R(),[N,E]=u.useState(!1),[j,v]=u.useState(new d(0)),[x,p]=u.useState(new d(0)),[b,I]=u.useState(new d(0)),[C,i]=u.useState(new d(0)),[l,f]=u.useState(null);u.useEffect(()=>{if(!a)return;(async()=>{try{const n=B(a);if(!n)return;const[t]=m.findProgramAddressSync([T.from("engine")],n.programId);if(console.log(t.toBase58()),await h.getAccountInfo(t)===null)return;const s=await n.account.engine.fetch(t);console.log(s.minHealthFactor.toString()),f({authority:s.authority.toBase58(),dscMint:s.dscMint.toBase58(),liquidationThreshold:s.liquidationThreshold,minHealthFactor:s.minHealthFactor,liquidationBonus:s.liquidationBonus,feePercent:s.feePercent})}catch(n){console.error("Failed to fetch engine:",n)}})()},[a]);const P=async()=>{if(a)try{const r=B(a);if(!r)return;const n=new m(o);if(!m.isOnCurve(n))throw new Error("Invalid mint address.");const[t]=m.findProgramAddressSync([T.from("engine")],r.programId);if(console.log(t.toBase58()),await h.getAccountInfo(t)!==null)throw new Error("Engine account already initialized for this token mint.");E(!0);const s=await r.methods.startEngine(j,C,x,b).accountsStrict({engine:t,authority:a.publicKey,dscMint:n,systemProgram:K.programId,tokenProgram:M}).transaction(),{blockhash:w,lastValidBlockHeight:y}=await h.getLatestBlockhash("finalized");s.recentBlockhash=w,s.lastValidBlockHeight=y,s.feePayer=a.publicKey;const A=await a.signTransaction(s),k=await h.sendRawTransaction(A.serialize());await h.confirmTransaction({blockhash:w,lastValidBlockHeight:y,signature:k});const g=await r.account.engine.fetch(t);f({authority:g.authority.toBase58(),dscMint:g.dscMint.toBase58(),liquidationThreshold:g.liquidationThreshold,minHealthFactor:g.minHealthFactor,liquidationBonus:g.liquidationBonus,feePercent:g.feePercent})}catch(r){console.error("Transaction failed:",r)}finally{E(!1)}};return e.jsxs("div",{className:"Create card p-4",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Create Engine"}),e.jsx("input",{type:"number",step:"0.000001",min:"0",value:j.toNumber()/1e6,onChange:r=>{const n=r.target.value,t=parseFloat(n);if(!isNaN(t)&&t>=0){const c=new d(Math.floor(t*1e6));v(c)}},placeholder:"Enter liquidation threshold (e.g. 85 for 85%)",className:"p-2 border mb-2 w-full"}),e.jsx("input",{type:"number",step:"0.000001",min:"0",value:C.toNumber()/1e6,onChange:r=>{const n=r.target.value,t=parseFloat(n);if(!isNaN(t)&&t>=0){const c=new d(Math.floor(t*1e6));i(c)}},placeholder:"Enter liquidation threshold (e.g. 85 for 85%)",className:"p-2 border mb-2 w-full"}),e.jsx("input",{type:"number",step:"0.000001",min:"0",value:x.toNumber()/1e6,onChange:r=>{const n=r.target.value,t=parseFloat(n);if(!isNaN(t)&&t>=0){const c=new d(Math.floor(t*1e6));p(c)}},placeholder:"Enter liquidation bonus (e.g. 5 for 5%)",className:"p-2 border mb-2 w-full"}),e.jsx("input",{type:"number",step:"0.000001",min:"0",value:b.toNumber()/1e6,onChange:r=>{const n=r.target.value,t=parseFloat(n);if(!isNaN(t)&&t>=0){const c=new d(Math.floor(t*1e6));I(c)}},placeholder:"Enter liquidation threshold (e.g. 85 for 85%)",className:"p-2 border mb-2 w-full"}),e.jsx("button",{onClick:P,disabled:!(a!=null&&a.publicKey)||N,className:"bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600",children:N?"Creating...":"Start Engine"}),l&&e.jsxs("div",{className:"mt-4 p-4 border rounded bg-black text-white border-gray-700",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Engine Data"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Min Health Factor:"})," ",S(l.minHealthFactor,1e6)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Liquidation Threshold:"})," ",S(l.liquidationThreshold,1e6),"%"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Liquidation Bonus:"})," ",S(l.liquidationBonus,1e6),"%"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Redemption Fee:"})," ",S(l.feePercent,1e6),"%"]})]})]})}function ce(){const o=O;return e.jsx("div",{className:"w-full bg-gray-950 text-white min-h-screen py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6",children:[e.jsxs(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center mb-16",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white",children:"Interest Program Configuration"}),e.jsx("p",{className:"text-lg text-gray-400 mt-4 max-w-2xl mx-auto",children:"Manage the core settings and start the engine for the Credix protocol."}),e.jsxs("div",{className:"flex justify-center items-center gap-6 mt-6",children:[e.jsx(q,{label:"Program ID",path:`address/${J}`,className:"text-purple-400 hover:text-purple-300 transition-colors"}),e.jsx(q,{label:"DSC Mint",path:`address/${o}`,className:"text-purple-400 hover:text-purple-300 transition-colors"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-start",children:[e.jsxs(D,{className:"bg-gray-900/50 border-gray-800 h-full",children:[e.jsxs(F,{children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-purple-600 rounded-md",children:e.jsx(ee,{className:"h-5 w-5 text-white"})}),e.jsx(_,{className:"text-2xl text-white",children:"Add Config"})]}),e.jsx(H,{className:"text-gray-400",children:"Set the initial configuration parameters for a new engine instance."})]}),e.jsx(V,{children:e.jsx(te,{})})]}),e.jsxs(D,{className:"bg-gray-900/50 border-gray-800 h-full",children:[e.jsxs(F,{children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-purple-600 rounded-md",children:e.jsx(Y,{className:"h-5 w-5 text-white"})}),e.jsx(_,{className:"text-2xl text-white",children:"Start Engine"})]}),e.jsx(H,{className:"text-gray-400",children:"Initialize and activate the engine with the specified configuration."})]}),e.jsx(V,{children:e.jsx(ae,{})})]})]})]})})}export{ce as default};
